<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="template/survey.xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns="http://java.sun.com/jsf/composite/trigger" xmlns:con="http://java.sun.com/jsf/composite/container" xmlns:f="http://java.sun.com/jsf/core" xmlns:text="http://java.sun.com/jsf/composite/text" xmlns:ques="http://java.sun.com/jsf/composite/question" xmlns:ans="http://java.sun.com/jsf/composite/answer" xmlns:dis="http://java.sun.com/jsf/composite/display">
  <ui:param name="progress" value="93"/>
  <ui:define name="template-content">
    <action command="navigatorBean.redirect('indexWarning')" condition="zofar.toInteger(episode_index.value) lt 0" onExit="false" navigator="#{navigatorBean}">
      <scriptItem value="zofar.log('episode index -1, backup to calendar',sessionController.participant)"/>
    </action>
    <action command="zofar.nothing()" onExit="false" navigator="#{navigatorBean}">
      <scriptItem value="zofar.assign('toReset',zofar.list())"/>
      <scriptItem value="toReset.add('v_startmonth')"/>
      <scriptItem value="toReset.add('v_startyear')"/>
      <scriptItem value="toReset.add('v_endmonth')"/>
      <scriptItem value="toReset.add('v_endyear')"/>
      <scriptItem value="toReset.add('staa19a')"/>
      <scriptItem value="toReset.add('staa19b')"/>
      <scriptItem value="toReset.add('staa19c')"/>
      <scriptItem value="toReset.add('staa19d')"/>
      <scriptItem value="toReset.add('staa19e')"/>
      <scriptItem value="toReset.add('staa19f')"/>
      <scriptItem value="toReset.add('staa19g')"/>
      <scriptItem value="toReset.add('staa19h')"/>
      <scriptItem value="toReset.add('staa20')"/>
      <scriptItem value="zofar.resetVars(toReset)"/>
    </action>
    <action command="zofar.nothing()" onExit="false" navigator="#{navigatorBean}">
      <scriptItem value="zofar.assign('defrac',zofar.str2jsonArr(zofar.defrac(zofar.list(episodes_fragment_1,episodes_fragment_2,episodes_fragment_3,episodes_fragment_4))))"/>
      <scriptItem value="zofar.assign('episodeObj',zofar.getOrCreateJson(defrac,zofar.toInteger(episode_index.value))) "/>
      <scriptItem value="zofar.assign('monthMap',zofar.map('1=ao1,2=ao2,3=ao3,4=ao4,5=ao5,6=ao6,7=ao7,8=ao8,9=ao9,10=ao10,11=ao11,12=ao12'))"/>
      <scriptItem value="zofar.assign('yearMap',zofar.map('2018=ao1,2019=ao2,2020=ao3,2021=ao4,2022=ao5,2023=ao6,2024=ao7'))"/>
      <scriptItem value="zofar.assign('startDate',zofar.getJsonProperty(episodeObj,'startDate')) "/>
      <scriptItem value="zofar.assign('endDate',zofar.getJsonProperty(episodeObj,'endDate')) "/>
      <scriptItem value="zofar.setVariableValue(v_startmonth,zofar.getFromMap(monthMap,zofar.getMonthFromStamp(startDate)+1))"/>
      <scriptItem value="zofar.setVariableValue(v_startyear,zofar.getFromMap(yearMap,zofar.getYearFromStamp(startDate)))"/>
      <scriptItem value="zofar.setVariableValue(v_endmonth,zofar.getFromMap(monthMap,zofar.getMonthFromStamp(endDate)+1))"/>
      <scriptItem value="zofar.setVariableValue(v_endyear,zofar.getFromMap(yearMap,zofar.getYearFromStamp(endDate)))"/>
      <scriptItem value="zofar.assign('toLoad',zofar.list())"/>
      <scriptItem value="toLoad.add('staa19a')"/>
      <scriptItem value="toLoad.add('staa19b')"/>
      <scriptItem value="toLoad.add('staa19c')"/>
      <scriptItem value="toLoad.add('staa19d')"/>
      <scriptItem value="toLoad.add('staa19e')"/>
      <scriptItem value="toLoad.add('staa19f')"/>
      <scriptItem value="toLoad.add('staa19g')"/>
      <scriptItem value="toLoad.add('staa19h')"/>
      <scriptItem value="toLoad.add('staa20')"/>
      <scriptItem value="zofar.getJsonProperties(episodeObj,toLoad)"/>
    </action>
    <variable var="#{state}" value="'done'" direction="forward" condition="true" onExit="true" navigator="#{navigatorBean}"/>
    <action command="zofar.frac(zofar.list(episodes_fragment_1,episodes_fragment_2,episodes_fragment_3,episodes_fragment_4),zofar.jsonArr2str(defrac))" onExit="true" navigator="#{navigatorBean}">
      <scriptItem value="zofar.assign('defrac',zofar.str2jsonArr(zofar.defrac(zofar.list(episodes_fragment_1,episodes_fragment_2,episodes_fragment_3,episodes_fragment_4))))"/>
      <scriptItem value="zofar.assign('episodeObj',zofar.getOrCreateJson(defrac,zofar.toInteger(episode_index.value))) "/>
      <scriptItem value="zofar.assign('toPersist',zofar.map())"/>
      <scriptItem value="toPersist.put('staa19a',staa19a.value)"/>
      <scriptItem value="toPersist.put('staa19b',staa19b.value)"/>
      <scriptItem value="toPersist.put('staa19c',staa19c.value)"/>
      <scriptItem value="toPersist.put('staa19d',staa19d.value)"/>
      <scriptItem value="toPersist.put('staa19e',staa19e.value)"/>
      <scriptItem value="toPersist.put('staa19f',staa19f.value)"/>
      <scriptItem value="toPersist.put('staa19g',staa19g.value)"/>
      <scriptItem value="toPersist.put('staa19h',staa19h.value)"/>
      <scriptItem value="toPersist.put('staa20',staa20.value)"/>
      <scriptItem value="zofar.setJsonProperties('episodeObj',episodeObj,toPersist)"/>
      <scriptItem value="zofar.assign('episodeObj',zofar.setJsonProperty(episodeObj,'state',state.value))"/>
      <scriptItem value="zofar.assign('defrac',zofar.addOrReplaceJson(defrac,episodeObj,zofar.toInteger(episode_index.value)))"/>
    </action>
    <con:section id="placeholder_module_1" page="true">
      <f:facet name="header">
        <text:text container="true" id="t2">#{msgs['placeholder_module_1.t2_0']}</text:text>
        <text:text container="true" id="t1">#{msgs['placeholder_module_1.t1_0']}</text:text>
        <text:text container="true" id="i1">#{msgs['placeholder_module_1.i1_0']}</text:text>
        <text:text container="true" id="i2">#{msgs['placeholder_module_1.i2_0']}</text:text>
      </f:facet>
      <ques:multipleChoice id="mc1">
        <f:facet name="header">
          <text:question container="true" id="q1">#{msgs['placeholder_module_1.b.mc1.q1_0']}</text:question>
        </f:facet>
        <ans:multipleChoiceResponseDomain id="rd" missingSeparated="true">
          <ans:multipleOption value="#{staa19a.value}" id="ao1" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao1.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19b.value}" id="ao2" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao2.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19c.value}" id="ao3" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao3.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19d.value}" id="ao4" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao4.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19e.value}" id="ao5" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao5.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19f.value}" id="ao6" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao6.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19g.value}" id="ao7" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao7.label']}</text:responseOption>
            </f:facet>
          </ans:multipleOption>
          <ans:multipleOption value="#{staa19h.value}" id="ao8" missing="false">
            <f:facet name="labels">
              <text:responseOption id="label">#{msgs['placeholder_module_1.b.mc1.rd.ao8.label']}</text:responseOption>
            </f:facet>
            <ans:attachedOpenQuestion id="ato1" var="#{staa20}"/>
          </ans:multipleOption>
        </ans:multipleChoiceResponseDomain>
      </ques:multipleChoice>
      <con:section id="s1" isaccordion="true">
        <f:facet name="header">
          <text:title container="true" id="t">#{msgs['placeholder_module_1.b.s1.t_0']}</text:title>
        </f:facet>
        <dis:container id="tech">
          <dis:text id="debug0">#{msgs['placeholder_module_1.b.s1.b.tech.debug0_0']}#{msgs['placeholder_module_1.b.s1.b.tech.debug0_2']}#{msgs['placeholder_module_1.b.s1.b.tech.debug0_4']}</dis:text>
          <dis:text id="debug1">#{msgs['placeholder_module_1.b.s1.b.tech.debug1_0']}</dis:text>
          <dis:text id="debug2">#{msgs['placeholder_module_1.b.s1.b.tech.debug2_0']}</dis:text>
          <dis:text id="debug3">#{msgs['placeholder_module_1.b.s1.b.tech.debug3_0']}#{msgs['placeholder_module_1.b.s1.b.tech.debug3_2']}</dis:text>
          <dis:text id="debug4">#{msgs['placeholder_module_1.b.s1.b.tech.debug4_0']}</dis:text>
          <dis:text id="debug5">#{msgs['placeholder_module_1.b.s1.b.tech.debug5_0']}</dis:text>
          <dis:text id="debug6">#{msgs['placeholder_module_1.b.s1.b.tech.debug6_0']}</dis:text>
        </dis:container>
      </con:section>
      <ques:pretest id="questioncommentplaceholder_module_1">
        <f:facet name="header">
          <text:question container="true" id="textcommentplaceholder_module_1">#{msgs['textcommentplaceholder_module_1_0']}</text:question>
        </f:facet>
        <ans:openResponseDomain id="responsedomain">
          <ans:largeOpenOption rows="3" maxlength="2000" validationMessage="#{msgs['questioncommentplaceholder_module_1']}" columns="100" var="#{commentplaceholder_module_1}" id="response"/>
        </ans:openResponseDomain>
      </ques:pretest>
    </con:section>
  </ui:define>
</ui:composition>